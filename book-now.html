<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Book Now | Harvest Havens Farm</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- =========================
     EMBEDDED CSS
========================= -->
<style>
  body{
    margin:0;
    font-family:Arial, sans-serif;
    background:#f3f6f4;
  }

  .container{
    max-width:500px;
    margin:60px auto;
    background:#fff;
    padding:25px;
    border-radius:10px;
    box-shadow:0 15px 40px rgba(0,0,0,.15);
  }

  h1{
    text-align:center;
    color:#2e7d32;
  }

  input, button{
    width:100%;
    padding:12px;
    margin-top:12px;
    border-radius:6px;
    border:1px solid #ccc;
    font-size:16px;
  }

  button{
    background:#2e7d32;
    color:white;
    border:none;
    cursor:pointer;
    font-weight:bold;
  }

  button:hover{
    background:#1b5e20;
  }

  .hidden{
    display:none;
  }

  .note{
    text-align:center;
    color:#555;
    margin-bottom:15px;
  }
</style>
</head>

<body>

<div class="container">
  <h1 id="title">Book Now</h1>
  <p class="note" id="subtitle"></p>

  <!-- AUTH -->
  <div id="auth">
    <input type="email" id="email" placeholder="Email" required>
    <input type="password" id="password" placeholder="Password" required>
    <button id="authBtn">Login / Register</button>
  </div>

  <!-- BOOKING FORM -->
  <form id="bookingForm" class="hidden">
    <input type="text" id="name" placeholder="Full Name" required>
    <input type="date" id="date" required>
    <input type="number" id="people" placeholder="Number of People" min="1" required>
    <button type="submit">Confirm Booking</button>
  </form>
</div>

<script type="module">
  // =========================
  // FIREBASE IMPORTS (CDN)
  // =========================
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
  import { 
    getAuth, 
    signInWithEmailAndPassword,
    createUserWithEmailAndPassword,
    onAuthStateChanged
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { 
    getFirestore,
    addDoc,
    collection,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // =========================
  // FIREBASE CONFIG (YOURS)
  // =========================
  const firebaseConfig = {
    apiKey: "AIzaSyDjNcMWpJ8zO2j0Z4vH8GOFPHK2Tt8pOF4",
    authDomain: "harvesthaven-97c9c.firebaseapp.com",
    projectId: "harvesthaven-97c9c",
    storageBucket: "harvesthaven-97c9c.firebasestorage.app",
    messagingSenderId: "917659415383",
    appId: "1:917659415383:web:6707371353cbeab8424412",
    measurementId: "G-PW7RVTHN0E"
  };

  // =========================
  // INITIALIZE FIREBASE
  // =========================
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // =========================
  // GET URL PARAMS
  // =========================
  const params = new URLSearchParams(window.location.search);
  const item = params.get("item");
  const type = params.get("type");

  document.getElementById("title").innerText = `Book: ${item}`;
  document.getElementById("subtitle").innerText =
    type === "event" ? "Event Booking" : "Attraction Booking";

  // =========================
  // ELEMENTS
  // =========================
  const authBox = document.getElementById("auth");
  const bookingForm = document.getElementById("bookingForm");

  document.getElementById("authBtn").onclick = async () => {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    try {
      await signInWithEmailAndPassword(auth, email, password);
    } catch {
      await createUserWithEmailAndPassword(auth, email, password);
    }
  };

  // =========================
  // AUTH STATE
  // =========================
  onAuthStateChanged(auth, user => {
    if (user) {
      authBox.classList.add("hidden");
      bookingForm.classList.remove("hidden");
    }
  });

  // =========================
  // SAVE BOOKING
  // =========================
  bookingForm.onsubmit = async (e) => {
    e.preventDefault();

    await addDoc(collection(db, "bookings"), {
      userId: auth.currentUser.uid,
      name: name.value,
      date: date.value,
      people: people.value,
      item,
      type,
      createdAt: serverTimestamp()
    });

    alert("ðŸŽ‰ Booking confirmed!");
    bookingForm.reset();
  };
</script>


</body>
</html>
